name: 自动巡检任务

# 触发条件：当代码被 push（推送）到 main 分支时执行
#on:
  #push:
    #branches: [ "main" ]
on:
  push:
    branches: [ "main" ]
  schedule:
    # 这里的 cron 表达式表示每 10 分钟运行一次
    # 分 时 日 月 周 (UTC时间，比北京时间晚8小时)
    - cron: '*/10 * * * *'
  workflow_dispatch: # 加上这一行，你的 Actions 页面就会多出一个“手动执行”按钮

jobs:
  inspection:
    # 告诉 GitHub 给你准备一台 Ubuntu 虚拟机
    runs-on: ubuntu-latest

    steps:
      # 第一步：把你的代码下载到这台虚拟机上
      - name: 检出代码
        uses: actions/checkout@v3

      # 第二步：安装 Python 环境
      - name: 安装 Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      #安装依赖用于钉钉群转发
      - name: 安装依赖
        run: pip install requests

      # 第三步：执行你的巡检脚本
      - name: 执行巡检脚本
        env:
          DINGTALK_WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}
        run: python check_server.py
